## SQL 개요

- 데이터 정의어, Data Definition Language
  -  `CREATE`, `ALTER`
  - 테이블이나 관계 구조 생성에 사용
- 데이터 조작어, Data Manipulation Language
  - `SELECT`, `INSERT`, `DELETE`, `UPDATE`
  - 테이블에 데이터를 검색, 삽입, 수정, 삭제하는데 사용
- 데이터 제어어, Data Control Language
  - `GRANT`, `REVOKE`
  - 데이터 사용 권한 관리하는데 사용

<br>

## 데이터 조작어 - 검색

### SELECT 문

- WHERE 조건절에 사용가능한 연산자

  - =, <, >, <=, >=

    - ```sql
      select * from staff where id > 10;
      ```

  - BETWEEN

    - ```sql
      select * from staff where id between 10 and 100; 
      ```

  - IN, NOT IN

    - ```sql
      select * from staff where id in (10, 12, 15);
      ```

  - LIKE

    - ```sql
      select * from staff where name like '%youngjin%';
      ```

  - IS NULL, IS NOT NULL

    - ```sql
      select * from staff where salary is null;
      ```

  - AND, OR, NOT

    - ```sql
      select * from staff where id = 10 or id = 20;
      ```

<br>

### 집계 함수

```sql
-- sum
select sum(salary) from staff; -- 임금 총합

-- avg
select avg(salary) from staff; -- 임금 평균

-- count
select count(*) from staff;    -- 전체 직원 수

-- min
select min(salary) from staff; -- 최저 임금 

-- max
select max(salary) from staff; -- 최고 임금
```

<br>

### GROUP BY

- `속성`이 같은 값끼리 그룹을 만들수 있다.
- 투플을 그룹으로 묶는다.

### HAVING

- HAVING은 GROUP BY와 함께 쓰며, `속성의 검색조건`이 된다.

- WHERE과 함께 쓸 경우 HAVING은 WHERE 절 뒤에서 정의한다.

  - ```sql
    select    customerId
    from      orders
    where     saleprice >= 5000
    group by  customerId
    having    count(*) >= 2;
    ```

### JOIN

- 두 개의 테이블을 결합해서 조회

- ```sql
  select *
  from   customers, orders
  where  customers.id = orders.customerId
  ```

### SELF JOIN

- 하나의 테이블을 대상으로 조인하는 것.

- ```sql
  select *
  from   staff emp, staff manager
  where  emp.mgr = manager.id and manager.name like '%andy%'; 
  ```

### OUTER JOIN

- JOIN 조건절에 포함되지 않은 결과도 함께 추출하고자 할 때 사용

- ```sql
  -- 주문 id와 고객 id를 매칭하여 실제 주문한 이력이 있는 고객 조회 쿼리
  -- OUTER JOIN 사용하여 주문하지 않은 고객도 조회
  select  customers.name
  from    customers
  left outer join orders
  on      customers.id = orders.customerId;
  ```

- **LEFT OUTER JOIN** : from 절에 선언된 테이블 기준으로 JOIN 조건절(`ON`) 수행
- **RIGHT OUTER JOIN** : 해당(`RIGHT OUTER JOIN`) 절에 선언된 테이블 기준으로 JOIN 조건절(`ON`) 수행 

### 부속 질의

- SQL 문내에 SQL문

- ```sql
  select  nation, name, number
  from    players
  where   goal = (select max(goal)
                  from   players)
  ```

- 부속 질의는 아래 SELECT 절부터 아래에서 위로 올라가며 읽는다.

### EXISTS

- 조건에 맞는 투플이 존재할 경우 조회

- ```sql
  select c.name, c.address
  from   customer c
  where  exists ( select * from orders o where c.id = o.customerId  )
  ```

- 부속질의문이 먼저 수행되며, 첫번째 질의에 결과가 존재할 경우 `EXISTS`가 참이되어 `c.name`과 `c.address`가 결과에 포함된다.

- 이렇게 테이블의 투플마다 부속질의문이 수행되며 `EXISTS`가 판단하여 결과에 포함시키는 수행을 반복한다.

<br>

## 데이터 정의어

### CREATE

- **NOT NULL** : null 허용하지 않는 제약
- **UNIQUE** : 유일한 값에 대한 제약
- **DEFAULT** : 기본값 설정
- **CHECK** : 값에 대한 조건 부여할 때 사용
- **PRIMARY KEY** : 기본 키를 정의
- **FOREIGN KEY** : 외래 키를 정의
- **ON DELETE** : 투플 삭제 시 외래키 속성 동작을 정의
  - **CASCADE** : 부모 테이블의 투플을 변경시(`UPDATE`/`DELETE`), FK로 연결된 자식 테이블의 투플 역시 반영되도록  
  - **SET NULL** : 부모 테이블의 투플을 변경시, FK로 연결된 자식 테이블의 투플은 NULL이 되도록
  - **RESTRICT** : 위의 옵션을 지정하지 않을 경우 기본 옵션 = no action. 

```sql
CREATE TABLE [테이블명]
  ADD FOREIGN KEY [속성이름] REFERENCES [자식테이블명(속성이름)]
    ON DELETE CASCADE 
```



### ALTER



### DROP



<br>

## 데이터 조작어 - 삽입, 수정, 삭제

### INSERT



### UPDATE



### DELETE



<br>